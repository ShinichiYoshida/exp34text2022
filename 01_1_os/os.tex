%目的：アプリケーションソフトウェアの実行環境の整備
%ハードウェアの設置・接続・設定
%コンピュータアーキテクチャ・仕様目的に対して
%適切なOSの選択

\section{目的}

基本ソフトウェア（オペレーティングシステム(Operating System)：OS）は，様々
なアプリケーションソフトウェアで共通に必要とされる処理を提供するプログラ
ムである．現在では，ネットワークサービスを含む全ての応用ソフトウェア（ア
プリケーションソフトウェア，Application Software）\footnote{ 応用ソフト
ウェアは，コンピュータ利用者が必要とする具体的な処理を行うものである．例
えば，文書の作成，編集を行うワードプロセッサ，表形式のデータに対してデー
タ間の計算や集計を行う表計算ソフト，Webサービスを提供するWebサーバなどで
ある．}は，何らかの基本ソフトウェア上で動作するよう開発されているので，
これらを用いる場合は，そのアプリケーションソフトウェアを動作させることの
できる適切なOSが必要がある．

このことから，ネットワークサービスを構築する際は，まず構築するサービスに適し
たOSを選定し，適切にインストール（導入作業）を行い，OSが提供するネットワーク機能（プロトコルスタック）を適切に設定した後，必要なネットワークサービスを提供するアプリケーションソフトウェアをインストールするという手順を踏む必要がある．

\section{実験内容の概要}

下記を構築する．
\begin{itemize}
    \item ネットワークサーバを構築するための基盤
    \item オンプレミス（実機）\footnote{オンプレミス(On-premises): 店内，学内，構内に導入すること}でサーバOSをクリーンインストール
    \item クラウド\footnote{Cloud: インターネットを空の雲の中に見立てて，雲のどこにあるかは意識せずに使いたいときに，使いたいだけ使えるようにするコンピュータ（のリソース（資源））}（仮想）上で同様に基盤をデプロイ\footnote{デプロイ(deploy): 配置＝使えるようにすること}
\end{itemize}

ネットワークサービスに関する応用ソフトウェアを実行する環境を構築するため
にOS をクリーンインストールし，ネットワーク設定を行う．クリーンインストールとは，インストールするコンピュータのストレージ（補助記憶装置，ハードディスクドライブ(HDD)やソリッドステートディスク(SSD)のこと）を完全に初期化された状態から，OSの開発元が提供するインストール用のメディア（CD-ROM/DVD-ROM/USBメモリ）を用いてOSをインストールすることである．クリーンインストールではない方法として，既に購入時にインストールされていたOSや古いOSに対してアップグレードや消去せずに上書きする形でインストールするものがある．

まず，OS をクリーンインストールするために，下記を行う．

\begin{enumerate}
 \item OSインストール用メディアの準備およびブート
 \item ハードディスクの初期化
 \item ユーザアカウントの作成
 \item その他のユーザ登録情報の設定
\end{enumerate}

\paragraph{USBメディアからの起動(ブート:boot)}
クリーンインストールを行うためには，ハードディスクの初期化が必要になるた
めに，インストール作業中はハードディスクを利用できないため，インストール
およびブート用のメディアを別途準備し，それを用いてブートする．

\paragraph{パーティション分割(partitioning)・フォーマット(format)}
ハードディスクの初期化とは，具体的にはハードディスクをいくつかの領域に用途別に分割する設定，
およびOSがどのパーティションを使用するかの指定を行い，そのパーティションにOSが用いる
ファイルシステムを作成する．ファイルシステムとはOSのハードディスクを利用するためのフォーマット（形式）であり，
その形式で使えるようにする初期化作業をフォーマットと言う．

ユーザアカウントは，最低1つの管理者用アカウントが必要であり，更に使用す
るユーザ毎にアカウントを設定する必要がある．アカウント設定を行うことで，
複数のユーザが同じ端末を共有することができる(電子メールやブラウザのブッ
クマーク等の設定を個々で行える)．

次に，TCP/IP ネットワーク設定を行うために，次のことを行う．

\begin{itemize}
 \item ネットワークインターフェースの設定
\end{itemize}

ネットワークインターフェースの設定に先だって，ネットワークインタフェースハードウェアの存在が OS から認識されていない場合は，そのハードウェアのメーカが提供するデバイスドライバをインストールする．

ネットワークインターフェースの確認は以下のコマンドを使う．

\begin{cli}
Linux の場合
# ip address (ip a と省略可)

古いLinux, その他のUNIX (macOS含む) の場合
# ifconfig -a
\end{cli}

以上のコマンドで，「eth0」や「enp2s0」，「en0」(macOS)など，インターフェース名と呼ばれる文字列から始まる行があれば良い．「e」は有線LANのEthernetからきている．なお，「lo」などは，ループバックインターフェース (loopback) で，すべてのTCP/IPに対応したOSが持ってる仮想的なインターフェースであり，それがあっても直ちにネットワークが有効であるとは判断できない(IPアドレスは，IPv4は 127.0.0.1, IPv6 が ::1)．

その後，ネットワークインターフェースに対して，IPアドレス，ネットマスク，
デフォルトゲートウェイ，DNSサーバアドレス，プロキシサーバのアドレスとポー
トを指定する．

最後に，OS のアップデート作業をネットワーク経由で行う．OS は，不具合やセ
キュリティ上の問題が現れた場合，メーカからインターネット経由での更新プロ
グラムが提供される．OS のインストール時点で，様々な不具合やセキュリティ
上に問題が明らかになっていることも多いため，インストール後，すぐに最新の
状態まで更新することが重要である．

\section{OSの基本的機能}

OSの役割は，基本的な機能をアプリケーションに提供することである．更に現在
ではマルチタスクOSと呼ばれ，複数のアプリケーションを同時に動作させるので，
キーボードやディスク，画面などのデバイス（ハードウェア）資源（リソース）
を管理し，複数のアプリケーションソフトウェアの間のデバイスが共用できるよ
う，その利用の調停を行うこともOSの役割である．

現代の OS では，特に重要なデバイス管理として下記の3つが挙げられる．
\begin{itemize}
 \item メモリ（主記憶）管理 （実メモリとスワップファイルによる仮想メモリ）
 \item プロセス管理 （マルチタスク TSS）
 \item ストレージ（補助記憶）管理 （ファイルシステム）
\end{itemize}

加えて，現在のOSは複数のユーザが同時に使うものであるので，ユーザ管理（権限管理）がある．これはセキュリティにも密接に関連し，セキュリティインシデントは，しばしばこの権限管理が想定外になった場合に引き起こされる．

\begin{itemize}
    \item ユーザ管理 (マルチユーザ)
\end{itemize}

さらに，それに加えて，下記のネットワーク接続，すなわち 
LAN\footnote{Local Area Network} および TCP/IP\footnote{Transmission
Control Protocol/Internet Protocol} 接続のサポートも，近年の OS では重要
な機能の一つである．
OS のうちネットワークプロトコルを提供する部分をプロトコルスタックと呼ぶ．

\begin{itemize}
 \item ネットワーク管理
\end{itemize}

その他，ディスプレイやプリンタ，キーボードやマウス，タッチパネルなどの，
入出力装置の管理も行う．

クライアントユーザが主な利用者となるクライアントOSでは，利用者の利便性向
上のための統一的な GUI (Graphical User Interface）デスクトップ，
ビデオ・グラフィクス・サウンド機能の提供などがある．Apple 社の Mac OS X 
や iOS，Microsoft 社の Windows，Google の Android などは，GUI 部分も OS 
ベンダが提供し，別の独自 GUI を適用することはできないが，Linux や BSD 系 
OS などは，OS 本体には GUI 機能は含まれておらず，GUI 用のソフトウェアを
用意することで使うことができる．GUI 用ソフトウェアにもいくつかの種類があ
り，X Window System が標準的に用いられる．X Window System には，基本的な
ウィンドウ管理機能しか含まれておらず，デスクトップ用途の機能(例えば，ア
イコン表示や，ダブルクリックで起動する機能，タスクバーやドラッグアンドド
ロップ)は，さらに別のソフトウェアを用いる．よく用いられるものは，GNOME 
と KDE であるが，それ以外にもウィンドウマネージャと呼ばれるソフト群が数
多く存在し，ユーザの好みで切り替えることができる．

つまり，アプリケーションに共通に必要とされる，資源管理，入出力，ネットワー
クなどの基本機能を提供するのが OS の役割である．

\section{OSの種類}

本節では，より具体的にOSの種類，機能について述べる．

OSは，コンピュータのアーキテクチャ（CPU やメモリ，周辺装置の構造，駆動方
法）に依存して様々なものがある．たとえば，図\ref{tab:01:computers-os}に
示すように，コンピュータにはそれぞれに適した OS が用いられている．

\begin{table}[h]
\caption{コンピュータとOS}
\label{tab:01:computers-os}
\begin{center}
 \begin{tabular}[t]{c|l}
 \Hline
 コンピュータ & OS\\
 \hline
 パーソナルコンピュータ（Apple Macintosh） & macOS\\
 パーソナルコンピュータ（Intel CPU PC/AT） & Microsoft Windows, Linux, UNIX系OS, ChromeOS\\
 スーパーコンピュータ（Intel または独自 CPU） & Linux, UNIX系OS，独自OS\\
 スマートフォン & Android(Linuxベース)，iOS，独自OS\\ \hline
 \end{tabular}
\end{center} 
\end{table}


以下にパーソナルコンピュータやネットワークサーバでよく用いられるOSを挙げる．
\begin{itemize}
  \item UNIX系OS
  \begin{itemize}
    \item Linux\\
	  Linux は，Linus Torvards がフィンランドの大学院生であった頃に
	  開発された OS で，当時有償であった UNIX と同じ機能を持つ互換
	  OS として作成された．OS の基本的機能を提供するカーネル部分のみ
	  が開発され，それ以外の，シェル・コマンド・ライブラリ・コンパイ
	  ラ等は，MIT の GNU プロジェクトのものを用いる．カーネル以外の
	  部分の組み合わせ方は，OS をインストールするものが様々なものを
	  選択し，アプリケーションソフトェアも様々であるので，それらをパッ
	  ケージにまとめた，全体のインストールパッケージが，100種類以上
	  ある．これをディストリビューションと呼ぶ．大きく，Debian 系，
	  RedHat系，Slackware 系ディストリビューションに分かれる．ディス
	  トリビューション間の互換性があるものもあるが，ない場合も多い．
	  \begin{itemize}
	   \item Ubuntu\\
		 Ubuntu は UNIX 系 OS の一つである Linux のディストリビューション
		 \footnote{Distribution: Linux OS の配布形態には数多くの種類があ
		 り，Ubuntu はその一つである}の一つで，Debian 系\footnote{Linux
		 系，Debian系，Slackware系があり，それぞれ rpm(RedHat Package Manager)，
		 deb，tgz という別の仕組みのパッケージ管理システムを採用してい
		 る．}のディストリビューションである．
	   \item CentOS\\
		 Cent OS は，RedHat 系ディストリビューションの1つで，サー
		 バのプラットフォームとしてよく用いられる有償の RedHat
		 に互換のものを，無償のオープンソースで作成しているもの
		 であり，多くのサーバのプラットフォームとして用いられる．
	  \end{itemize}
	  高性能コンピュータを超並列に配置したスーパーコンピュータの OS
	  として，現在ではしばしば用いられるほか，スマートフォン用 OS の
	  Android のベースとして用いられたり，Google のサービスに用いら
	  れるなど，大規模なものから組み込みまで，様々な規模の計算に用い
	  られている．

    \item FreeBSD\\
      FreeBSD はUNIX 系OS の一つで，現在のサーバにしばしば用いられるOS の
      一つである．FreeBSD には，定期的に一般に公開されるバージョンである
      RELEASE と2 つの開発用のバージョン（CURRENT とSTABLE）とがある．
      元来，UNIX には，BSD系とSystemV系との2つの系統があり，それぞれ，カ
	  リフォルニア大学バークレイ校，AT\&T （アメリカの電話会社） で
	  開発された．BSD は，TCP/IP の開発・実装に用いられ，現在のイン
	  ターネットの基盤技術の開発に大きく貢献した．現在でも，ネットワー
	  クの技術開発によく用いられる他，Linux と並んで大企業や有名ウェ
	  ブサイトなどのサービス運営に用いられるほか，組み込み機器などに
	  も使われる．
  
  \end{itemize}
  \item macOS\\
macOS は，アメリカのコンピュータメーカの Apple 社が販売するコンピュータ
	「Macintosh」に用いられている OS である．元々，Mac OS 1, 2, 3と続き，9 の次にリリースされた MacOS X は「マックオーエステン」と呼称し，アーキテクチャが大きく更新された（互換性がなくなった）．X	には，10番目という意味がある．Mac OS 9 までと異なり，MacOS X は，
	全く新規に UNIX（FreeBSD, Mach等）および NextSTEP をベースに構築された OS である．The Open Group の認証を受けた正式な	UNIX OS である．2020年には，Apple M1 CPUが搭載され，それまでのものとは大きく異なる仕様に変更された．
  \item Windows\\
Windows は Microsoft 社が販売している OS であり，1980年代から開発が行わ
	れ，日本では 1993年に Windows 3.1 が発売されたものが最初である．
	当時は，Microsoft 社の低機能の CUI (Character User Interface) で
	ある MS-DOS 上で動作する OS であり，16ビット CPU である 8086 系
	CPUで動作するものであった．その後，16ビット CPU 系 OS の後継とし
	て，Windows 95, Windows 98, Windows ME (Millennium Edition) が，
	32ビット CPU 系 OS として WindowsNT, Windows2000, WindowsXP,
	Windows Vista が使われた．WindowsXP 以降は，64ビット CPU 向け OS 
	も発売されるようになり，32ビット版と64ビット版の両方の CPU アー
	キテクチャ向けに発売されている．Windows Vista，Window 7，Windows
	8, 8.1 がリリースされ，2021年時点では，Windows 10 が最新バージョ
	ンである．コンピュータのメモリ容量が 2GB 以上の場合は64ビット版
	を，それより小さい場合は32ビット版を用いるのが効率的であるが，使
	用するアプリケーションソフトやデバイスドライバにより対応状況が異
	なるため，どちらかを使わなければならない場合もあり，使用用途を良
	く考え選択する必要がある．
\end{itemize}

これまで多くのOSで，32ビット版，64ビット版がリリースされていたが，2020年からは，4GBメモリを下回るコンピュータはほとんどなくなり，新規にリリースされるOSは64ビットのみであることがほとんどとなっている．

\section{実験内容(1)}

ハードウェアのセットアップと，各コンピュータへのOSのインストールを行った
後，ネットワークの設定を行う．

ハードウェアの設定の流れを，下記に示す．
\begin{itemize}
  \item 端末となるコンピュータのハードウェアセッテイング
	\begin{itemize}
	 \item キーボードの接続
         \item モニタの接続
	 \item マウスの接続（サーバ用コンピュータには必須ではない）
	\end{itemize}
  \item 各装置の電源の接続
  \item 各端末へのOSのインストール
  \item OSインストール後，各端末において必要となる初期設定
  \item ユーザの追加
\end{itemize}


各端末のハードウェアと使用OSの対応は表\ref{tab:01:osandcomp}である．

\begin{table}[ht]
 \caption{使用OSと対象コンピュータ}
 \label{tab:01:osandcomp}
 \begin{center}
  \begin{tabular}{l|l}
    \hline
     OS  &  対象コンピュータ  \\
    \hline
     Ubuntu Linux または別の UNIX系OS & サーバ用コンピュータ ASUS RS-100   \\
     Ubuntu Linux & クライアント用 UNIX 系コンピュータ\\
            & Dell Power Edge T110 \\
     Windows 10 (Education 64ビット版)& クライアント用 Microsoft Windows
   コンピュータ \\
	   & HP ノートPC   \\
     macOS & クライアント用 Macintosh コンピュータ\\
     & ノートPC MacBook Air M1 2020 \\
     ChromeOS　& クライアント用 ChromeBook \\
    \hline
  \end{tabular}
 \end{center}
\end{table}

使用するハードウェアは以下に挙げる条件で設定を行う．

\begin{itemize}
 \item デスクトップPCのキーボード接続はUSB接続を用いる．
 \item サーバには，HHK(Happy Hacking Keyboard)と呼ばれる，英語のテンキー
       のないキーボードを用いる．
 \item Dell製タワーPCには，Dell 製英語キーボードを用いる．
 \item デスクトップPCのディスプレイ接続は，D-SUB 15ピン，アナログ RGB 接続を用いる
       （``D'' の字を横にしたような，端子のピンが3列15個あるもの）．ただ
       し，Mac には Display Port 変換アダプタ，Windows デスクトップには，
       DVI-I（ディジタル・アナログ混在端子）と RGB の変換アダプタが必要
       になる．
 \item 端子のピンは細く，折れ曲がりやすいので，無理に差し込むなどはしな
       いこと．
\end{itemize}

日本語キーボードと英語キーボードは，記号類のキーの位置や，制御用のキーの
位置が異なる．設定を間違うと，キートップに印字されている記号と，実際に入
力される記号が異なるので，注意する．

\section{必要となる知識}

\subsection{ハードウェア}

現在，一般的に汎用OSで用いられるコンピュータのハードウェアは，インテル製
CPU かその互換 CPU （例えば，AMD 製など）を搭載し，メモリが数GB，ディス
ク装置が数100GB，数TBのものが一般的である．Microsoft Windows，Linux，FreeBSD な
ど，様々な OS をインストールして，異なる用途に用いることができる．一部の
製品では，Windows をインストールすることを念頭に開発され，その他の OS で
用いることが難しい，あるいは，Windows 以外では一部のハードウェア機能を用
いることできないなどの問題が生じる場合がある\footnote{低価格のもの，新機
能が多用されている新製品，ノート型PCなどは Windows 以外では機能制限され
る場合が多く，古い（枯れた）ハードウェアやサーバ用途製品では Linux など
で容易に用いることができる場合が多い．}．

\subsection{キーボード・マウス接続}

キーボード・マウス接続には，大きく分けて，下記の2通りがある．
\begin{itemize}
 \item PS/2
 \item USB
\end{itemize}

PS/2 接続は，USB が開発される以前から存在した接続で，丸い端子で，キーボー
ドは紫色，マウスは緑色で示されている．現在では，新製品にはあまり用いられ
ていない．一部のサーバ向けハードウェアでは，互換性を重視する観点から，
PS/2 端子を備えているものがあるが現在は，ほぼ USB に統一されている．

USB は，Universal Serial Bus の略称で，それまでキーボードやマウス，その
他のデバイス接続において，デバイス毎に個別の接続端子が必要であったものを，
全ての接続デバイスで統一的に(universal)に用いることができるシリアル接続
端子(Serial Bus) を構築することを目的に開発された．

90年代後半の USB 1.1 以来，速度の向上がはかられており，現在では下記のよ
うな規格がある．

\begin{description}
 \item[USB 1.1] 1.5Mbps と 12Mbps の帯域幅がが存在．マウスやキーボードな
	    どの低速デバイス向け．電源供給は，5V, 500mA (2.5W) までであ
	    り，ポータブル HDD など電力が大きいものは，セルフパワーと呼
	    ばれ，機器側でコンセントから電源供給する必要がある．
 \item[USB 2.0] 480Mbps の帯域幅で，外部ハードディスクやカメラ，マイクを
	    はじめ幅広く用いられる．
 \item[USB 3.2 Gen 1x1 (USB3.0)] 5Gbps でハードディスクやハイビジョン品質映像キャプチャデ
	    バイスなどの高帯域幅が必要なものに用いられる．青色など，それ
	    までの USB 2.0 と異なる色で示されることが多い．電源供給能力
	    も向上し，4.5W（5V, 900mA）まで供給可能である．
 \item[USB 3.2 Gen 2x1 (USB 3.1)] 伝送速度を 10Gbps に高速化した規格．電源供給能力も強化さ
	    れ(USB-PD)，100W まで供給できる．USB-C と呼ばれる新しい端子
	    も採用され，小型化され端子の向きも裏表どちらでも差し込めるよ
	    うになり，PC側・機器側の端子の形状も同じとなった．Apple の
	    2015年の MacBook では，電源端子も含め外部接続ポートは USB-C
	    1ポートに統一され，2016年の MacBook Pro では，USB-C ポート
	    （Apple Thunderbolt 3 端子を兼用）が4ポートとなった．
 \item[USB 3.2 Gen 2x2] 端子がUSB-Cのみとなり，最大20Gbps．
 \item[USB4] Apple Thunderbolt 4と統合され，画面出力等幅広く使われる．まだApple製品以外では採用されていない．
\end{description}

本実験では，全て，USB 接続のマウス・キーボードとなっている．

\subsection{キーボードの配列}

日本では，キーボード配列には，下記のように大きく2通りの配列がある．

\begin{description}
 \item[日本語配列] キーボードのキートップに，日本語のカナが印字されてい
	    るもの．キーボードの数から，106配列，109 配列，JIS配列などと
	    も呼ばれる．
 \item[英語配列] キーボードのキートップに英語のみ印字されているもので，
	    全世界的に英語圏を中心に使われているもの．101配列，104配列，
	    US配列などとも呼ばれる．
\end{description}

両者の配列では，アルファベットや数字の位置は変わらないが，記号の位置が異
なるので，接続するキーボードと設定を誤らないようにする必要がある．誤った
場合は，キーボードに表示されている記号と実際に入力される記号が異なって入
力され，場合によっては一部の記号は入力できない．

\subsection{ディスプレイインターフェース}

ディスプレイの接続規格には，下記のようなものがある．

\begin{description}
 \item[Dsub 15ピン] RGB アナログインターフェースであり，20年以上用いられ
	    てきており，現在でも，ディスプレイやプロジェクタなどにしばし
	    ば用いられる．赤(R)，緑(G)，青(B) の3原色の量をアナログ（電
	    圧）で表現した信号であり，垂直周波数，水平周波数などが合って
	    いないと正しく接続できない．RGB，VGA，Dsub，Dsub 15ピン，ア
	    ナログなどと呼ばれる．
 \item[DVI] ディジタルに対応したインターフェースである．アナログ RGB と
	    の互換性も取られており，アナログ信号とディジタル信号を混在し
	    て送ることができるが，一方がディジタルのみ，あるいはアナログ
	    のみにか対応していない場合は，接続しても正しく表示できない．
	    ディジタルのみの DVI-D，アナログのみの DVI-A，両者を同時に送
	    ることができる DVI-I があり，形状が異なる．DVI-A はアナログ
	    RGB と，DVI-D は HDMI と，変換ケーブルを使って接続できる．
 \item[HDMI] 近年，普及したディジタル専用インターフェースで，コンピュー
	    タの他，テレビなど，ディジタルデバイスに広く用いられている．
	    音声も同時に送ることが可能な他，3D やディープカラーなど先進
	    的な送信にも対応している．
 \item[Display Port] Mac や小型ノートPCなどで用いられる端子．
 \item[Thunderbolt] Mac で用いられる端子．
\end{description}

\subsection{ユーザID・グループID}
UNIX系OSをはじめ，現代のオペレーティングシステムでは，マルチユーザ環境
を実現しているが，ユーザの識別に用いられる数値をユーザID(UID)と呼んでい
る．ユーザIDは，16ビット程度であることが多く，その場合は，32767（符号つ
  き）や65535（符号なし）の値が上限である．UNIX系OS では，UID 0 は常に
スーパーユーザ（ユーザ名 root）\footnote{UNIX における特権ユーザであり
  管理者権限を持つユーザである}である．

また，1つ以上のユーザに対してまとめてファイルやプロセスの権限付与操作を
行うためのグループの概念がある．このグループも，グループごとに一意に数
値を持ち，これをグループID（GID）と呼ぶ．GID 0 は，BSD系では wheel と呼
ばれる，root へユーザ権限を変更できるユーザのグループとして定義され，
管理者グループであるユーザを，wheel グループに登録しておく．

多くのOSのユーザアカウント作成では，UID や GID は重複のない番号が自動的
に割り振られるので，通常はこれを用いれば良い．

これらの値をはじめとするユーザアカウント情報は，/etc/passwd, /etc/shadow
\footnote{シャドウパスワードと呼ばれるパスワード保護の仕組みのあるUNIXの
み存在する}, /etc/group に登録されている．passwd ファイルや shadow は，
実際はファイルの内容が別のファイルにデータベース化されてからオペレーティ
ングシステムで使用されるので，vi エディタなどで直接編集せず，vipw コマン
ドで編集を行う（ファイルそのものはテキストファイルなので閲覧は可能）．

\begin{cli}
# vipw
\end{cli}

また，wheelにユーザを追加した場合，システムが正常に終了（shutdown）できることも確かめておくとよい．
\subsection{デバイスファイル}

UNIX 系サーバでは，コンピュータに接続される全てのデバイスは，デバイスファ
イルとして，ファイルシステムの一部に現れている．通常，/dev ディレクトリ
以下に全てのデバイスファイルがある．

このうち，よく用いるディスクデバイスについて述べておく．ディスクデバイス
は，ディスク（やその一部のパーティション）の先頭セクタ（ブロック）から順
に一本の長いデータとして表されている．このディスクのブロックの集まりを，
raw ファイル （生ファイル）などと呼ぶ．通常は，OSのファイルシステムを介
してディスクの読み書きを行うので，raw ファイルを用いることはない．万が一，
raw ファイルを誤って破壊すると，ファイルシステムが壊れ，ファイルが正常に
読み書きできなくなる．

\begin{table}[ht]
 \begin{center}
  \caption{ディスクデバイスファイル}
  \begin{tabular}{l|l}
   \Hline
   /dev/sda (, sdb, sdc,...) & HDD, USBメモリ等 (，2台目，3台目，...)\\
   /dev/sda1 (, sda2, ...) & 1番目のディスクのパーティション1 (, 2, ... )\\
   \Hline
  \end{tabular}
 \end{center}
\end{table}

パーティション操作は，fdisk, gpart コマンドなどで行える．

\subsection{パーティション}

パーティションは，一つの物理ディスクを複数の領域に分けて，それぞれを論理
的に一つのディスクとして扱うというものである．パーティションを分割してい
る場合は，複数のディスク(領域)が OS から見えるようになる．OS 本体のプロ
グラムとデータを異なるパーティションにおくこともできる．また，異なる OS 
を別々のパーティションにインストールし，起動時(ブート時)にどの OS を起動
するか選択することもできる．

\begin{figure}[h]
 \begin{center}
  \includegraphics[width=15cm]{\chapos 01-partition.eps}
  \caption{パーティション}
  \label{fig:01:partition}
 \end{center}
\end{figure}

パーティション情報は，具体的には，ディスクの先頭部分に，各パーティション
がどこからどこまでであるかを書き込むことで構成し，全ての OS はブート時お
よびブート後に，その領域情報に基づいて必要な領域のみにデータの読み書き操
作を行う．

ディスクの先頭部分を，MBR (Master Boot Record) と呼ぶ．従来のパーソナル
コンピュータでは，この MBR にブートローダ(起動プログラム)とパーティショ
ン情報をパーティションテーブルに書き込んでおき，このブートローダがパーティ
ションテーブルを参照し，起動するパーティションから OS を読み込む．
MBR 形式パーティションの設定は，通常 fdisk コマンドが使われる（Windows,
Mac 以外の UNIX 系）．

MBRは 2TB 以上の容量には対応できないため，最近は，GPT (GUID Partition
Table) 形式でパーティション情報を保存するものが増えてきている(MacOS X,
Windows 10, Linux，FreeBSD 9.0)．GPT にはブートローダは入っておらず，パー
ティションテーブルのみがある．ブートローダは，コンピュータのマザーボード
上のチップセットに格納されている EFI (または UEFI: Unified Extensible
Firmware Interface) に入っている．UNIX 系 OS では，gpart あるいは gdisk 
コマンドで操作を行う．Windows 7 など最新でない OS では GPT では不都合が
ある場合もあるが，最新の OS はほとんど GPT・EFI に対応し，今後はこちらが
主流になる．

\subsection{サーバOSの操作に必要なコマンド}
サーバOSを操作するコマンドを表\ref{tab:01:command}に挙げる．
\begin{table}[ht]
 \begin{center}
  \caption{UNIX系OS基本コマンド}
  \label{tab:01:command}
  \begin{tabular}{l|l}
   \Hline
   シャットダウン & shutdown -h now \\
   再起動 & reboot \\
   ログアウト & exit \\
   ユーザアカウント作成 & useradd \\
   アカウント情報変更 & chsh \\
   アカウント情報変更(rootのみ) & vipw \\
   ディスクマウント状況確認 & mount \\
   ディスク容量，パーティション確認 & df -k \\
   ディレクトリ以下のファイル総容量 & du -k \\
   ファイル操作 & cp, mv, ls, cd \\
   ページャ & more, less \\
   メッセージ記録 & script ファイル名 \\
   ファイル検索 & find ディレクトリ -name 'ファイル名' -print \\
   ファイル内容検索 & grep キーワード ファイル1 ファイル2 ... \\
   パーティション操作 & gpart サブコマンド HDDのデバイスファイル\\
   ディスク初期化（format） & newfs パーティションのデバイスファイル\\
   \Hline
  \end{tabular}
 \end{center}
\end{table}
サーバOS は，GUI (Graphical User Interface) を用いずに，CUI (Character
User Interface) による CLI (Command Line Interface) で，コマンドによる操
作のみで運用を行うことが多い．このため，CUI 操作で必要な UNIX コマンドを
よく調べておくと，今後の操作が円滑に行える．

また，エディタとして，vi や emacs に慣れておくと良い．特に，vi は UNIX
系 OS では標準的に備わっているので，最低限の操作には慣れておくこと．

コマンドには，様々なオプションが付いており，これらをよく理解し使いこなす
ことで，操作性を上げることができる．どのようなコマンドがあるかは，man コ
マンドでオンラインマニュアルを調べることができる．例えば，man コマンドの
マニュアルを読むには，下記のようにすれば良い．

\begin{cli}
# man man
\end{cli}

\subsection{ユーザアカウントの作成とパスワードの設定}
Linux おけるユーザアカウントの追加を useradd コマンドで行う．

man コマンドで詳しい使い方を閲覧できる．

\begin{cli}
# man useradd

SYNOPSIS
       useradd [options] LOGIN

       useradd -D

       useradd -D [options]
\end{cli}

\begin{cli}
# useradd -c 'フルネームなど' -m ユーザ名
\end{cli}

-c はローマ字で本名などを書く．空白を含む場合は，シングルクォーテーショ
ン\'で囲む．-m はホームディレクトリも自動的に作成する．ホームディレクト
リは，/home ディレクトリ以下に作成される．

ユーザ名は，8文字以下の英数字で，英語大文字は使わない（小文字のみ）かつ1
文字目は数字を使わない．

パスワードの設定は passwd コマンドを用いる．

\begin{cli}
# passwd ユーザ名
\end{cli}

ユーザの作成を終えたら，ログイン情報が記録されたファイルを調べる．

/etc/passwd ファイルがそうであり，1行に1アカウント分の情報が，コロン : 
で区切られて記載されている．このファイルは全てのユーザが閲覧できる必要が
ある．以前は，ここにパスワードもハッシュ化されて記載されていたが，実際の
パスワード情報は，別のシャドウファイル（shadow）に置かれており，root ユー
ザしか閲覧できないようになっている．編集，およびパスワード（ハッシュ化さ
れているので，パスワードそのものはたとえスーパーユーザでも分からない）の
閲覧は，vipw を用いることで行う．グループの所属情報は，/etc/group に記録
されている．

ls コマンドでユーザディレクトリが作成されているかも確認する．

\begin{cli}
# ls -l /home/
\end{cli}


\section{必要な情報}
\subsection{サーバOS}

ホスト名：serverX  （Xの部分は，グループ番号で置き換えること）．

その他，下記の要領で設定を行う．

\begin{itemize}
 \item ディスクパーティションの設定については任意の設定を行って良いが，
       ルートパーティションに十分な容量（数10GB）を割り当てること．
 \item ユーザ ``exp'' をインストール時に作成する．
 \item exp ユーザのパスワードは，``root00'' とする（この項目は，実験実施上必要
 な措置であり，実運用においては十分長く，推測されにくく，辞書などにない
       パスワードを設定すること）．
 \item グループ全員分のユーザアカウントを作成する．
\end{itemize}

\subsection{クライアントOS}
クライアント OS については，下記の通り設定を行う．

\begin{itemize}
 \item 管理者ユーザアカウントを1つ作成する（可能な限り管理者ユーザ名は，
       ``exp'' とする）．管理者ユーザのパスワードは，``root00'' にする．
 \item ユーザ登録画面などが出た場合は，氏名は「KUT GroupX」（Xはグループ
       名），住所等は，大学のものを登録する．
 \item Chromebook では，Google アカウントが必要なため，kutexpG@gmail.com (Gはグループ番号) というアカウントを作成し，これを使う．またパスワードは強固なものとし，TAに伝える．
 \item ネットワーク設定は後に行うので，特に設定しなくて良い．
 \item ディスクのパーティション設定は，オペレーティングシステムのための
       領域をあまり小さくしすぎないこと．これは，オペレーティングシステ
       ムの運用が始まると，スワップファイルや一時ファイルを作成するので，
       これらのための領域が足りないと動作に支障を及ぼすためである．
\end{itemize}

クライアント OS のホスト名は，表 \ref{tab:01:client-hostname}の通りとす
る．ただし，表中 X はグループ番号を表す．図 \ref{fig:01:system} も参照の
こと．

\begin{table}[h]
\caption{クライアントOSのホスト名}
\label{tab:01:client-hostname}
\begin{center}
 \begin{tabular}[t]{c|c}
 \Hline
 コンピュータ・OS & ホスト名\\
 \hline
 Desktop Linux & linux \\
 Windows 10 ノート & win \\
 Apple Macbook & mac \\
 Chromebook & chrome\\ \hline
 \end{tabular}
\end{center}
\end{table}

\section{OSのインストール手順}
\subsection{Ubuntu}

\begin{itemize}
\item{\bf インストールメディアの挿入} \\
Ubuntu はオープンソース OS であり，インターネッ
トに公開されている．インターネット上から，最新バージョン（または所望する
バージョン）のイメージをダウンロードする．イメージとは，記録メディア
（CD, DVD，HDD，SSDなど）に記録されている情報を，先頭ブロックから最後ま
で順番に記録したファイルであり，イメージライタと呼ばれるソフトウェアで，
メディアに書き込むことで，インストール等が行えるメディアが作成できる．CD 
やDVD等のメディアは，ファイルシステムの形式が ISO 規格\footnote{国際標準
化機構，本部スイス・ジュネーブ}で定められたものであり (ISO 9660など），
CDやDVD向けのイメージファイルは，iso 形式などと呼ばれる．

Ubuntu 20.04 LTS server 64ビット版のインストールメディアを用いてインストー
     ルする．

\item{\bf 起動}\\
DVD を挿入したら，リセットボタンまたは，電源を押し直すなどして再起動する．DVD
ドライブから起動しない場合は，\keybox{F8} を押すとブート選択メニューが出
るので，光学ドライブを選択する．

\item{\bf インストール言語，キーボード配列}\\

Language（インストール言語）は，「English」とする．

\item{\bf Install}\\

「Install Ubuntu Server」を選択する．

（インストール時の言語を再度聞かれるが，English にする）

\item{\bf 国・地域設定}\\

時計などの国の設定を行う．

「other」→「Asia」→「Japan」を選択する．

「locale」（ロケール）設定は，ここでは，「en\_US.UTF-8」を選択．

\item{\bf キーボード}\\

キーボードは英語版を選択する（通常は，US で良い．UK にはしない）．

ここで間違えると，キーボードのキートップの文字と入力される文字が異なるこ
とになり，使いにくくなる．

\item{\bf ネットワーク設定}\\

ホスト名は，「serverX」（Xはグループ番号）とする．

（入力したら，TAB を押して「Continue」までいって Enter を押す）．

\item{\bf 一般ユーザ設定}\\

ユーザ「exp」を作成する（Full name もアカウントのユーザ名も exp で良い）．

パスワードは，「root00」とする．

弱いパスワードを用いるか確認されるが，これを用いることを選択する．

ホームディレクトリの暗号化も聞かれるが，ここでは行わないこととする．

\item{\bf 時計設定}\\

タイムゾーンを確認する (Asia/Tokyo)．

この設定を正しく行わないと時刻がずれ，メールやファイル共有で困る場合があ
     る．

\item{\bf partition}\\

パーティションの設定を行う．Guided はガイダンス
つき，Manual が完全に操作者が自由に設定可能な手動モードである．

Entire disk を選択して，ディスク全体を使うよう設定する．

なお，LVM（Logical Volume Manager：論理ボリュームマネージャ）は，ディス
ク利用の自由度を大きく向上させるが，設定が難しくなる面もあり，ここでは用
いないこととする．

また暗号化は行わない．

sda ＝1台目のディスクを選択する．

ディスクに変更を書き込むか聞かれるので，書き込むことを確認する．

パーティション設定は，既存のディスク情報（データやOS，その他の配置情報）
をすべて上書きしてしまうので，既存のデータには基本的にアクセスできなくな
る（消去されることと同じ）．パーティション等のディスク操作は，注意して操
作する習慣をつける．

このため，ここでは，操作を決定する前に本当に操作を行って良いか問われる．
ディスク sda のパーティション情報(partition 1, 5等)，そ
れぞれのフォーマット情報 (ext4 や swap など）が表示されるので，問題なければ，
実行する．

\item{\bf パッケージマネージャのプロキシ}\\

パッケージマネージャ（ソフトウェアのインストールツール）のプロキシを尋ね
られるがここでは，空白としておく%% （ネットワークの設定後に行う）
．

\item{\bf アップデートの設定}\\

アップデートは，セキュリティ上重要だが，サーバではアップデートの影響を慎
重に考える必要があり，ここでは自動アップデートは行わないようにする．

\item{\bf 初期ソフトウェアの設定}\\

最初からチェックの入っているものはそのままとし，それ以外からは，OpenSSH
     server を，リモートログインでの作業とファイルコピーを行うためにイ
     ンストールする．

\item{\bf ブートローダ GRUB}\\

ブートローダをマスタブートレコード（MBR） に導入しないと OS が起動しない
     ため，MBR に GRUB のインストールを行う．

以上で終了である．Continue を選択し再起動する．

\item{\bf 再起動}\\
再起動は，DVD-RW メディアを抜いて行う．

\item{\bf ログイン}\\
login プロンプトが現れるので，exp ユーザでログインする．

その後，sudo su コマンドで管理者ユーザ root となる．

\begin{cli}
$ sudo su
# 
\end{cli}
%$

管理者となると，プロンプトが \$ から \# に変わる．

\item{\bf ユーザの追加}\\
ログインが無事行えたら，グループ内全員分のアカウントを作成する．

\end{itemize}


\section{考慮すべき点}

\paragraph{OSの必要性} 現在のコンピュータシステム，ネットワークシステム
を構築していくのに，なぜ OSが必要かを考える．適切な OS を各コンピュータ
に導入する必要性は何かを考える．また，現在の OS にはどのような機能が必要
とされるか，あるいは備えているか．将来は，どのようなものが求められるかを
考える．

\paragraph{ユーザ権限} ユーザの権限や管理者権限の必要性について考える．

